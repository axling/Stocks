%%% File    : data_lib_tests.erl
%%% Author  : Erik Axling <dude@CodeMachine>
%%% Description : 
%%% Created :  8 Nov 2010 by Erik Axling <dude@CodeMachine>

-module(data_lib_tests).

-include_lib("eunit/include/eunit.hrl").

mvg_avg_test() ->
    ?assertMatch([10.0, 10.0, 10.0], data_lib:mvg_avg([10,10,10,10], 2)),
    ?assertMatch([25.0], data_lib:mvg_avg([10,20,30,40], 4)),
    ?assertMatch([15.0, 25.0, 35.0], data_lib:mvg_avg([10,20,30,40], 2)),
    ?assertError(function_clause, data_lib:mvg_avg([10,10], 3)).

ema_test() ->
    ?assertMatch([10.0], data_lib:ema([10,10], 2)),
    ?assertMatch([10.0, 10.0, 10.0], data_lib:ema([10, 10, 10, 10], 2)),
    ?assertMatch([15.0, 25.0, 35.0], data_lib:ema([10, 20, 30, 40], 2)),
    ?assertError(function_clause, data_lib:ema([10], 2)).

macd_test() ->
    ?assertMatch({[0.0], [0.0]}, data_lib:macd(lists:duplicate(34, 10))),
    ?assertError(function_clause, data_lib:macd(lists:duplicate(33, 10))).

atr_test() ->
    Input = [
	     {48.7, 47.79, 48.16},
	     {48.72, 48.14, 48.61},
	     {48.9, 48.39, 48.75},
	     {48.87, 48.37, 48.63},
	     {48.82, 48.24, 48.74},
	     {49.05, 48.64, 49.03},
	     {49.20, 48.94, 49.07},
	     {49.35, 48.86, 49.32},
	     {49.92, 49.5, 49.91},
	     {50.19, 49.87, 50.13},
	     {50.12, 49.2, 49.53},
	     {49.66, 48.9, 49.5},
	     {49.88, 49.43, 49.75},
	     {50.19, 49.73, 50.03},
	     {50.36, 49.26, 50.31}],
    ?assertMatch([0.5542857142857146, 0.5932653061224494], 
		 data_lib:atr(Input, 14)).

dm_test() ->    
    Input = [{5, 5, 0},
	     {5, 2, 0},
	     {4, 3, 0},
	     {5, 3, 0}],
    ?assertEqual([{0, 3}, {0,0}, {1,0}], data_lib:dm(Input)).
    

adx_test() ->
    Input = [
	     {48.7, 47.79, 48.16},
	     {48.72, 48.14, 48.61},
	     {48.9, 48.39, 48.75},
	     {48.87, 48.37, 48.63},
	     {48.82, 48.24, 48.74},
	     {49.05, 48.64, 49.03},
	     {49.20, 48.94, 49.07},
	     {49.35, 48.86, 49.32},
	     {49.92, 49.5, 49.91},
	     {50.19, 49.87, 50.13},
	     {50.12, 49.2, 49.53},
	     {49.66, 48.9, 49.5},
	     {49.88, 49.43, 49.75},
	     {50.19, 49.73, 50.03},
	     {50.36, 49.26, 50.31},
	     {48.7, 47.79, 48.16},
	     {48.72, 48.14, 48.61},
	     {48.9, 48.39, 48.75},
	     {48.87, 48.37, 48.63},
	     {48.82, 48.24, 48.74},
	     {49.05, 48.64, 49.03},
	     {49.20, 48.94, 49.07},
	     {49.35, 48.86, 49.32},
	     {49.92, 49.5, 49.91},
	     {50.19, 49.87, 50.13},
	     {50.12, 49.2, 49.53},
	     {49.66, 48.9, 49.5},
	     {50.19, 49.87, 50.13}
	     ],
    ?assertMatch([20.91665236822243], 
		 data_lib:adx(Input, 14)).

stochastic_test() ->
    {[75.0], [47.22222222222222]} = data_lib:stochastic([{3, 1, 2}, {4, 2, 3}, 
				  {2, 1, 1}, {5, 2, 4}], 2). %[200/3, 0 75.0]


